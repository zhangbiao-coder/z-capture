!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("html2canvas")):"function"==typeof define&&define.amd?define(["exports","html2canvas"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["z-capture"]={},t.html2canvas)}(this,(function(t,e){"use strict";function o(t,e,o,n){return new(o||(o=Promise))((function(a,i){function s(t){try{r(n.next(t))}catch(t){i(t)}}function c(t){try{r(n.throw(t))}catch(t){i(t)}}function r(t){var e;t.done?a(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,c)}r((n=n.apply(t,e||[])).next())}))}function n(t,e){var o,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(c){return function(r){return function(c){if(o)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(i=0)),i;)try{if(o=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],n=0}finally{o=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,r])}}}"function"==typeof SuppressedError&&SuppressedError;var a=Symbol("selPen"),i=Symbol("selRect"),s=Symbol("clearCanvas"),c=Symbol("closeCut"),r=Symbol("saveCut"),u=Symbol("intoShot"),h=Symbol("drawImageMask"),l=Symbol("drawCutImageShot"),p=Symbol("drawOutShadow"),d=Symbol("restoreCanvasState"),f=Symbol("cutHandleCanvasMouseMove"),v=Symbol("drawFreeLine"),y=Symbol("cutHandleCanvasMouseUp"),S=Symbol("drawScreenImg"),b=Symbol("cutHandleCanvasMouseDown"),m=Symbol("isWithinCutShotArea"),w=Symbol("drawFreeRect"),g=Symbol("rightCloseCut"),x=Symbol("capture"),D={engine:"html2canvas",before:function(){return!0},start:function(){},end:function(){},save:function(t){return function(){return o(void 0,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,navigator.clipboard.writeText(t)];case 1:return e.sent(),[2]}}))}))}},after:function(){},error:function(t){console.error(t)}},T=function(){function t(t){var e,o,n,u,h=this;this.option={},this.cutImageStatus=!1,this.cutShotDataArray=new Array(4),this.shotPlugin="html2canvas",this.MASK_OPACITY=.5,this.cutInitPos=new Array(2),this.cutDown=!1,this.cutWaitStatus=!1,this.cutMouseState="",this.cutEditStatus=!1,this.cutRectStatus=!1,this.option=Object.assign({},D,t),this.captureWorkSpace=window.document.getElementById("z-capture-workspace-0726");var l=!1;this.captureWorkSpace||(this.captureWorkSpace=window.document.createElement("div"),this.captureWorkSpace.setAttribute("id","z-capture-workspace-0726"),this.captureWorkSpace.setAttribute("class","cutImageStatus"),this.captureWorkSpace.innerHTML='\n                              <canvas class="screenCanvas"></canvas>\n                              <div class="cut-tool">\n                                <div class="tool-left">\n                                  <button data-btnType="t-pen-btn" type="button" title="自定义-画笔">笔</button>\n                                  <button data-btnType="t-rect-btn" type="button" title="矩形-画框">框</button>\n                                  <button data-btnType="t-clear-btn" type="button" title="清空画布">清</button>\n                                </div>\n                                <span class="tool-fg"></span>\n                                <div class="tool-right">\n                                  <button data-btnType="t-cancel-btn" type="button" title="取消">取消</button>\n                                  <button data-btnType="t-save-btn" type="button" title="保存">保存</button>\n                                </div>\n                              </div>',window.document.body.append(this.captureWorkSpace),l=!0),this.canvas=null===(e=this.captureWorkSpace.getElementsByTagName("canvas"))||void 0===e?void 0:e[0],this.context=null===(o=this.canvas)||void 0===o?void 0:o.getContext("2d"),this.cutTool=null===(n=this.captureWorkSpace.getElementsByClassName("cut-tool"))||void 0===n?void 0:n[0],l&&(null===(u=this.cutTool.querySelector("button"))||void 0===u||u.addEventListener("click",(function(t){var e=t.target;if("BUTTON"!==e.tagName&&(e=e.closest("button")),e)switch(e.getAttribute("data-btnType")){case"t-pen-btn":h[a]();break;case"t-rect-btn":h[i]();break;case"t-clear-btn":h[s]();break;case"t-cancel-btn":h[c]();break;case"t-save-btn":h[r]()}})),this.canvas.addEventListener("mousedown",(function(t){h[b](t)})),this.canvas.addEventListener("mousemove",(function(t){h[f](t)})),this.canvas.addEventListener("mouseup",(function(t){h[y](t)})),this.canvas.addEventListener("contextmenu",(function(t){h[g](t)})))}return t.init=function(e){return new t(e)},t.prototype[x]=function(){var t=this;if(!(this.option.before&&this.option.before()))return!1;if("mediaDevices"===this.shotPlugin){var o=window.document.createElement("video");navigator.mediaDevices.getDisplayMedia({video:!0,preferCurrentTab:!0}).then((function(e){t.option.start&&t.option.start(),o.srcObject=e,setTimeout((function(){o.play().then((function(){t.canvas&&t.context&&(t.canvas.width=window.document.body.clientWidth,t.canvas.height=window.document.body.clientHeight,t.context.drawImage(o,0,0,t.canvas.width,t.canvas.height)),t[u](),e.getTracks().forEach((function(t){return t.stop()})),o.remove(),t.option.end&&t.option.end()}))}),500)})).catch((function(e){(t.option.error&&t.option.error(e),e)&&(~e.toString().indexOf("NotAllowedError: Permission denied")?console.log("用户取消共享屏幕，截屏失败"):console.error("Error: "+e));t[c]()}))}else this.option.start&&this.option.start(),e(window.document.getElementsByTagName("body")[0],{backgroundColor:"white",useCORS:!0,scale:1}).then((function(e){t.canvas&&t.context&&(t.canvas.width=window.document.body.clientWidth,t.canvas.height=window.document.body.clientHeight,t.context.drawImage(e,0,0,t.canvas.width,t.canvas.height)),t[u](),t.option.end&&t.option.end()}))},t.prototype[u]=function(){var t,e=this;this.cutImageStatus=!0,this.cutDown=!1,null===(t=this.cutTool)||void 0===t||t.remove(),this.cutWaitStatus=!1,this.canvasState=void 0,setTimeout((function(){e.canvas&&(e.cutScreenDataURL=e.canvas.toDataURL(),e[h](0,0,e.canvas.width,e.canvas.height,e.MASK_OPACITY))}),50)},t.prototype[h]=function(t,e,o,n,a){this.context&&this.cutImageStatus&&(this.context.fillStyle="rgba(0,0,0,".concat(a,")"),this.context.fillRect(t,e,o,n))},t.prototype[l]=function(t,e,o,n,a,i){this[p](o,n,a,i),this.context&&(this.context.globalCompositeOperation="destination-over"),this[S](t,e)},t.prototype[p]=function(t,e,o,n){this.context&&(this.context.globalCompositeOperation="destination-out",this.context.fillStyle="rgb(0,0,0)",this.context.fillRect(t,e,o,n))},t.prototype[S]=function(t,e){var o=new Image;o.src=this.cutScreenDataURL,this.context&&this.context.drawImage(o,0,0,t,e),o.remove()},t.prototype[d]=function(){this.canvasState&&this.context&&this.context.putImageData(this.canvasState,this.cutShotDataArray[0],this.cutShotDataArray[1])},t.prototype[b]=function(t){if(!this.cutWaitStatus&&this.cutImageStatus&&(this.cutInitPos=[t.offsetX,t.offsetY],this.cutDown=!0,this.cutMouseState="cut"),this.canvas&&this.context&&this.cutWaitStatus&&this[m](t.offsetX,t.offsetY)){this.cutInitPos=[t.offsetX,t.offsetY],this.cutDown=!0;var e=this.cutShotDataArray,o=e[0],n=e[1],a=e[2],i=e[3];this.canvasState=this.context.getImageData(o,n,a,i),this.cutEditStatus&&(this.cutMouseState="line",this.context.beginPath(),this.context.moveTo(t.clientX-this.canvas.offsetLeft,t.clientY-this.canvas.offsetTop)),this.cutRectStatus&&(this.cutMouseState="rect")}},t.prototype[f]=function(t){if(this.cutDown&&this.canvas&&this.context){var e=t.offsetX,o=t.offsetY,n=this.cutInitPos,a=n[0],i=n[1],s=e-a,c=o-i,r=this.canvas,u=r.width,p=r.height;switch(this.cutMouseState){case"cut":this.context.clearRect(0,0,u,p),this.cutShotDataArray=[a,i,s,c],this[h](0,0,u,p,this.MASK_OPACITY),this[l](u,p,a,i,s,c);break;case"line":this[m](e,o)&&this[v](t.clientX-this.canvas.offsetLeft,t.clientY-this.canvas.offsetTop);break;case"rect":this[m](e,o)&&this[w](a,i,s,c)}}},t.prototype[v]=function(t,e){this[d](),this.context&&(this.context.globalCompositeOperation="source-over",this.context.strokeStyle="red",this.context.lineWidth=2,this.context.lineTo(t,e),this.context.stroke())},t.prototype[w]=function(t,e,o,n){this[d](),this.context&&(this.context.globalCompositeOperation="source-over",this.context.beginPath(),this.context.strokeStyle="red",this.context.lineWidth=2,this.context.rect(t,e,o,n),this.context.stroke())},t.prototype[m]=function(t,e){return t>=this.cutShotDataArray[0]&&t<=this.cutShotDataArray[0]+this.cutShotDataArray[2]&&e>=this.cutShotDataArray[1]&&e<=this.cutShotDataArray[1]+this.cutShotDataArray[3]},t.prototype[y]=function(t){if(this.cutDown&&this.context)switch(this.cutMouseState){case"cut":this.cutDown=!1,this.cutWaitStatus=!0,this.captureWorkSpace&&this.cutTool&&(this.cutTool.style.top=t.offsetY+"px",this.captureWorkSpace.appendChild(this.cutTool)),this.cutMouseState="";break;case"line":case"rect":this.context.closePath(),this.cutMouseState="",this.cutDown=!1}},t.prototype[g]=function(t){t.preventDefault(),this[c]()},t.prototype[c]=function(){var t;this.cutImageStatus=!1,this.cutWaitStatus=!1,null===(t=this.cutTool)||void 0===t||t.remove(),this.option.after&&this.option.after()},t.prototype[a]=function(){this.cutWaitStatus&&(this.cutEditStatus=!0,this.cutRectStatus=!1)},t.prototype[i]=function(){this.cutWaitStatus&&(this.cutRectStatus=!0,this.cutEditStatus=!1)},t.prototype[s]=function(){if(this.canvas&&this.context){var t=this.cutShotDataArray,e=t[0],o=t[1],n=t[2],a=t[3];this.context.clearRect(e,o,n,a);var i=this.canvas,s=i.width,c=i.height;this.canvasState=void 0,this[l](s,c,this.cutShotDataArray[0],this.cutShotDataArray[1],this.cutShotDataArray[2],this.cutShotDataArray[3])}},t.prototype[r]=function(){if(this.canvas&&this.context){var t=this.cutShotDataArray,e=t[0],o=t[1],n=t[2],a=t[3],i=this.context.getImageData(e,o,n,a),s=window.document.createElement("canvas"),r=s.getContext("2d");null!=r&&(s.width=i.width,s.height=i.height,r.putImageData(i,0,0),this.cutShotDataURL=s.toDataURL("image/jpeg"),this.option.save&&this.option.save(this.cutShotDataURL)),s.remove(),this[c]()}},t}();t.ZCapture=T}));
//# sourceMappingURL=z-capture.umd.min.js.map
