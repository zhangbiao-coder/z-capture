!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("html2canvas-pro")):"function"==typeof define&&define.amd?define(["exports","html2canvas-pro"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ZCapture={},t.html2canvas)}(this,(function(t,e){"use strict";var o=Symbol("selPen"),a=Symbol("selRect"),i=Symbol("clearCanvas"),n=Symbol("closeCut"),s=Symbol("saveCut"),c=Symbol("intoShot"),r=Symbol("drawImageMask"),h=Symbol("drawCutImageShot"),u=Symbol("drawOutShadow"),l=Symbol("restoreCanvasState"),p=Symbol("cutHandleCanvasMouseMove"),d=Symbol("drawFreeLine"),v=Symbol("cutHandleCanvasMouseUp"),w=Symbol("drawScreenImg"),f=Symbol("cutHandleCanvasMouseDown"),S=Symbol("isWithinCutShotArea"),y=Symbol("drawFreeRect"),g=Symbol("rightCloseCut"),m=Symbol("correctionCoord"),b={engine:"html2canvas",before:function(){return!0},start:function(){},end:function(){},save:function(t){console.log(t)},after:function(){},error:function(t){console.error(t)}},x='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z"/></svg>',T='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-336c0-8.8 7.2-16 16-16l336 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 32C35.8 32 0 67.8 0 112L0 448zm160 0a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm192 0a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm-96 0a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm192 0a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zM416 288a32 32 0 1 0 0-64 32 32 0 1 0 0 64zm0 32a32 32 0 1 0 0 64 32 32 0 1 0 0-64zm0-128a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>',k='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M290.7 57.4L57.4 290.7c-25 25-25 65.5 0 90.5l80 80c12 12 28.3 18.7 45.3 18.7L288 480l9.4 0L512 480c17.7 0 32-14.3 32-32s-14.3-32-32-32l-124.1 0L518.6 285.3c25-25 25-65.5 0-90.5L381.3 57.4c-25-25-65.5-25-90.5 0zM297.4 416l-9.4 0-105.4 0-80-80L227.3 211.3 364.7 348.7 297.4 416z"/></svg>',D='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>',L='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg>',A=function(){function t(){var t,e,c,r=this;this.option={},this.cutImageStatus=!1,this.cutShotDataArray=new Array(4),this.MASK_OPACITY=.5,this.cutInitPos=new Array(2),this.cutDown=!1,this.cutWaitStatus=!1,this.cutMouseState="",this.cutEditStatus=!1,this.cutRectStatus=!1,this.captureWorkSpace=window.document.getElementById("z-capture-workspace-0726");var h=!1;this.captureWorkSpace||(window.top.z_capture?(this.captureWorkSpace=window.top.z_capture.captureWorkSpace,this.cutTool=window.top.z_capture.cutTool,window.document.body.append(this.captureWorkSpace)):(this.captureWorkSpace=window.document.createElement("div"),this.captureWorkSpace.setAttribute("id","z-capture-workspace-0726"),this.captureWorkSpace.setAttribute("style","z-index: 99999999999; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0;"),this.captureWorkSpace.innerHTML='<canvas class="screenCanvas" style="height: 100%;width: 100%"></canvas>',window.document.body.append(this.captureWorkSpace),this.cutTool=window.document.createElement("div"),this.cutTool.setAttribute("class","cut-tool"),this.cutTool.setAttribute("style","width: fit-content;position: absolute;background-color: white;display: flex;align-items: center;justify-content: space-around;"),this.cutTool.innerHTML='<style> \n                                               #z-capture-workspace-0726 button {width: 28px; height: 25px; border: none;vertical-align: bottom;cursor:pointer;background-color: white;fill: #767676;}\n                                               #z-capture-workspace-0726 button:hover {background-color: #f0f0f0;fill: #2196F3;}\n                                               #z-capture-workspace-0726 button svg{width: 100%; height: 100%;}\n                                           </style>\n                                           <div class="tool-left">\n                                              <button data-btnType="t-pen-btn" type="button" title="自定义-画笔">'.concat(x,'</button>\n                                              <button data-btnType="t-rect-btn" type="button" title="矩形-画框">').concat(T,'</button>\n                                              <button data-btnType="t-clear-btn" type="button" title="清空画布">').concat(k,'</button>\n                                           </div>\n                                           <span class="tool-fg" style="display: inline-block;width: 1px;border-right: 1px solid #a9a3a3;height: 18px;margin: 0 8px;"></span>\n                                           <div class="tool-right">\n                                              <button data-btnType="t-cancel-btn" type="button" title="取消">').concat(D,'</button>\n                                              <button data-btnType="t-save-btn" type="button" title="保存">').concat(L,"</button>\n                                           </div>"),h=!0)),this.canvas=null===(t=this.captureWorkSpace.getElementsByTagName("canvas"))||void 0===t?void 0:t[0],this.context=null===(e=this.canvas)||void 0===e?void 0:e.getContext("2d"),this.cutTool=this.cutTool||(null===(c=this.captureWorkSpace.getElementsByClassName("cut-tool"))||void 0===c?void 0:c[0]),h&&(this.cutTool.addEventListener("click",(function(t){var e=t.target;if("BUTTON"!==e.tagName&&(e=e.closest("button")),e)switch(e.getAttribute("data-btnType")){case"t-pen-btn":r[o](),r.cutTool.querySelector("button[data-btnType='t-rect-btn']").style.fill="#767676",e.style.fill="#3355ff";break;case"t-rect-btn":r[a](),r.cutTool.querySelector("button[data-btnType='t-pen-btn']").style.fill="#767676",e.style.fill="#3355ff";break;case"t-clear-btn":r[i]();break;case"t-cancel-btn":r[n]();break;case"t-save-btn":r[s]()}})),this.canvas.addEventListener("mousedown",(function(t){r[f](t)})),this.canvas.addEventListener("mousemove",(function(t){r[p](t)})),this.canvas.addEventListener("mouseup",(function(t){r[v](t)})),this.canvas.addEventListener("contextmenu",(function(t){r[g](t)}))),this.cutTool.remove()}return t.capture=function(e){var o=window.top.z_capture;return o||(o=new t,window.top.z_capture=o),o.capture(e)},t.prototype.capture=function(t){var o=this;if(this.option=Object.assign({},b,t||{}),!this.option.before())return!1;if("mediaDevices"===this.option.engine){var a=document.createElement("video"),i={video:{width:{ideal:window.screen.width},height:{ideal:window.screen.height},frameRate:{ideal:30}},preferCurrentTab:!0};navigator.mediaDevices.getDisplayMedia(i).then((function(t){o.option.start(),a.srcObject=t,a.onloadedmetadata=function(){a.play().then((function(){if(o.canvas&&o.context){var e=window.devicePixelRatio||1,i=a.videoWidth*e,n=a.videoHeight*e;o.canvas.width=i,o.canvas.height=n,o.context.drawImage(a,0,0,i,n)}o[c](),t.getTracks().forEach((function(t){return t.stop()})),a.remove()}))}})).catch((function(t){(o.option.error(t),t)&&(~t.toString().indexOf("NotAllowedError: Permission denied")?console.warn("用户取消共享屏幕，截屏失败"):console.error("Error: "+t));o[n]()}))}else this.option.start(),e(document.body,{backgroundColor:"white",useCORS:!0,scale:window.devicePixelRatio||1}).then((function(t){if(o.canvas&&o.context){var e=t.width,a=t.height;o.canvas.width=e,o.canvas.height=a,o.context.clearRect(0,0,o.canvas.width,o.canvas.height),o.context.drawImage(t,0,0,e,a)}o[c]()})).catch((function(t){o.option.error(t),console.error("html2canvas 生成图片失败:",t)}))},t.prototype[c]=function(){var t,e=this;this.cutImageStatus=!0,window.document.getElementById("z-capture-workspace-0726")||window.document.body.append(this.captureWorkSpace),this.cutDown=!1,null===(t=this.cutTool)||void 0===t||t.remove(),this.cutWaitStatus=!1,this.canvasState=void 0,setTimeout((function(){e.canvas&&(e.cutScreenDataURL=e.canvas.toDataURL("image/png"),e[r](0,0,e.canvas.width,e.canvas.height,e.MASK_OPACITY),e.option.end(e.cutScreenDataURL))}),50)},t.prototype[r]=function(t,e,o,a,i){this.context&&this.cutImageStatus&&(this.context.fillStyle="rgba(0,0,0,".concat(i,")"),this.context.fillRect(t,e,o,a))},t.prototype[h]=function(t,e,o,a,i,n){this[u](o,a,i,n),this.context&&(this.context.globalCompositeOperation="destination-over"),this[w](t,e)},t.prototype[u]=function(t,e,o,a){this.context&&(this.context.globalCompositeOperation="destination-out",this.context.fillStyle="rgb(0,0,0)",this.context.fillRect(t,e,o,a))},t.prototype[w]=function(t,e){var o=new Image;o.src=this.cutScreenDataURL,this.context&&this.context.drawImage(o,0,0,t,e),o.remove()},t.prototype[l]=function(){this.canvasState&&this.context&&this.context.putImageData(this.canvasState,this.cutShotDataArray[0],this.cutShotDataArray[1])},t.prototype[m]=function(t,e){var o=this.canvas.getBoundingClientRect(),a=this.canvas.width/o.width,i=this.canvas.height/o.height;return[(t-o.left)*a,(e-o.top)*i]},t.prototype[f]=function(t){var e=this[m](t.clientX,t.clientY),o=e[0],a=e[1];if(!this.cutWaitStatus&&this.cutImageStatus&&(this.cutInitPos=[o,a],this.cutDown=!0,this.cutMouseState="cut"),this.canvas&&this.context&&this.cutWaitStatus&&this[S](o,a)){this.cutInitPos=[o,a],this.cutDown=!0;var i=this.cutShotDataArray,n=i[0],s=i[1],c=i[2],r=i[3];this.canvasState=this.context.getImageData(n,s,c,r),this.cutEditStatus&&(this.cutMouseState="line",this.context.beginPath(),this.context.moveTo(o-this.canvas.offsetLeft,a-this.canvas.offsetTop)),this.cutRectStatus&&(this.cutMouseState="rect")}},t.prototype[p]=function(t){var e=this[m](t.clientX,t.clientY),o=e[0],a=e[1];if(this.cutDown&&this.canvas&&this.context){var i=o,n=a,s=this.cutInitPos,c=s[0],u=s[1],l=i-c,p=n-u,v=this.canvas,w=v.width,f=v.height;switch(this.cutMouseState){case"cut":this.context.clearRect(0,0,w,f),this.cutShotDataArray=[c,u,l,p],this[r](0,0,w,f,this.MASK_OPACITY),this[h](w,f,c,u,l,p);break;case"line":this[S](i,n)&&this[d](o-this.canvas.offsetLeft,a-this.canvas.offsetTop);break;case"rect":this[S](i,n)&&this[y](c,u,l,p)}}},t.prototype[d]=function(t,e){this[l](),this.context&&(this.context.globalCompositeOperation="source-over",this.context.strokeStyle="red",this.context.lineWidth=2,this.context.lineTo(t,e),this.context.stroke())},t.prototype[y]=function(t,e,o,a){this[l](),this.context&&(this.context.globalCompositeOperation="source-over",this.context.beginPath(),this.context.strokeStyle="red",this.context.lineWidth=2,this.context.rect(t,e,o,a),this.context.stroke())},t.prototype[S]=function(t,e){return t>=this.cutShotDataArray[0]&&t<=this.cutShotDataArray[0]+this.cutShotDataArray[2]&&e>=this.cutShotDataArray[1]&&e<=this.cutShotDataArray[1]+this.cutShotDataArray[3]},t.prototype[v]=function(t){if(this.cutDown&&this.context)switch(this.cutMouseState){case"cut":this.cutDown=!1,this.cutWaitStatus=!0,this.captureWorkSpace&&this.cutTool&&(this.captureWorkSpace.appendChild(this.cutTool),this.cutTool.style.left=t.clientX-this.cutTool.clientWidth+"px",this.cutTool.style.top=t.clientY+"px"),this.cutMouseState="";break;case"line":case"rect":this.context.closePath(),this.cutMouseState="",this.cutDown=!1}},t.prototype[g]=function(t){t.preventDefault(),this[n]()},t.prototype[n]=function(){this.cutImageStatus=!1,this.cutWaitStatus=!1,console.log("截图关闭.."),this.captureWorkSpace.remove(),this.option.after()},t.prototype[o]=function(){this.cutWaitStatus&&(this.cutEditStatus=!0,this.cutRectStatus=!1)},t.prototype[a]=function(){this.cutWaitStatus&&(this.cutRectStatus=!0,this.cutEditStatus=!1)},t.prototype[i]=function(){if(this.canvas&&this.context){var t=this.cutShotDataArray,e=t[0],o=t[1],a=t[2],i=t[3];this.context.clearRect(e,o,a,i);var n=this.canvas,s=n.width,c=n.height;this.canvasState=void 0,this[h](s,c,this.cutShotDataArray[0],this.cutShotDataArray[1],this.cutShotDataArray[2],this.cutShotDataArray[3])}},t.prototype[s]=function(){if(this.canvas&&this.context){var t=this.cutShotDataArray,e=t[0],o=t[1],a=t[2],i=t[3],s=this.context.getImageData(e,o,a,i),c=window.document.createElement("canvas"),r=c.getContext("2d");null!=r&&(c.width=s.width,c.height=s.height,r.putImageData(s,0,0),this.cutShotDataURL=c.toDataURL("image/png"),this.option.error("test-error"),this.option.save(this.cutShotDataURL)),c.remove(),this[n]()}},t}();t.ZCUtil=A}));
//# sourceMappingURL=z-capture.umd.min.js.map
