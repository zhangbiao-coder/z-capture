{"version":3,"file":"z-capture.umd.min.js","sources":["../node_modules/tslib/tslib.es6.js","../src/core/z.capture.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","import html2canvas from \"html2canvas\";\r\nimport {Option} from \"./option\";\r\n\r\n//‌保护对象属性‌：使用Symbol作为属性名可以隐藏对象的属性，使得在对象外部无法通过点语法访问这些属性，从而保护对象的私有属性‌\r\nconst selPen = Symbol(\"selPen\");\r\nconst selRect = Symbol(\"selRect\");\r\nconst clearCanvas = Symbol(\"clearCanvas\");\r\nconst closeCut = Symbol(\"closeCut\");\r\nconst saveCut = Symbol(\"saveCut\");\r\nconst intoShot = Symbol(\"intoShot\");\r\nconst drawImageMask = Symbol(\"drawImageMask\");\r\nconst drawCutImageShot = Symbol(\"drawCutImageShot\");\r\nconst drawOutShadow = Symbol(\"drawOutShadow\");\r\nconst restoreCanvasState = Symbol(\"restoreCanvasState\");\r\nconst cutHandleCanvasMouseMove = Symbol(\"cutHandleCanvasMouseMove\");\r\nconst drawFreeLine = Symbol(\"drawFreeLine\");\r\nconst cutHandleCanvasMouseUp = Symbol(\"cutHandleCanvasMouseUp\");\r\nconst drawScreenImg = Symbol(\"drawScreenImg\");\r\nconst cutHandleCanvasMouseDown = Symbol(\"cutHandleCanvasMouseDown\");\r\nconst isWithinCutShotArea = Symbol(\"isWithinCutShotArea\");\r\nconst drawFreeRect = Symbol(\"drawFreeRect\");\r\nconst rightCloseCut = Symbol(\"rightCloseCut\");\r\nconst capture = Symbol(\"capture\");\r\n\r\nconst defaultOption: Option = {\r\n    engine: 'html2canvas',\r\n    before: () => true,\r\n    start: () => {\r\n    },\r\n    end: () => {\r\n    },\r\n    save: (baseImg: string) => async () => {\r\n        //保存操作，图片默认写入用户剪贴板\r\n        await navigator.clipboard.writeText(baseImg);\r\n    },\r\n    after: () => {\r\n    },\r\n    error: (e) => {\r\n        console.error(e);\r\n    },\r\n}\r\n\r\nexport class ZCapture {\r\n    private option: Option = {};\r\n\r\n    //是否进入截图状态\r\n    private cutImageStatus = false;\r\n    //全屏截图\r\n    private cutScreenDataURL: any;\r\n    //截取后的图片\r\n    private cutShotDataURL: any;\r\n    private cutShotDataArray: Array<number> = new Array(4);\r\n\r\n    //绘制全屏canvas\r\n    private readonly captureWorkSpace: HTMLElement | undefined | null;\r\n    private readonly canvas: HTMLCanvasElement | undefined;\r\n    private readonly context: CanvasRenderingContext2D | null | undefined;\r\n\r\n    //截图操作工具栏\r\n    private readonly cutTool:HTMLElement | undefined;\r\n\r\n    /**\r\n     * 截图插件选择(默认使用：html2canvas)\r\n     * html2canvas：html转canvas方式实现截图\r\n     * mediaDevices：使用浏览器的录屏设备来实现截图\r\n     */\r\n    private shotPlugin = \"html2canvas\";\r\n\r\n    constructor(option?: Option) {\r\n        this.option = Object.assign({}, defaultOption, option);\r\n        this.captureWorkSpace = window.document.getElementById(\"z-capture-workspace-0726\");\r\n        let first = false;\r\n        if (!this.captureWorkSpace) {\r\n            this.captureWorkSpace = window.document.createElement(\"div\");\r\n            this.captureWorkSpace.setAttribute(\"id\", \"z-capture-workspace-0726\");\r\n            this.captureWorkSpace.setAttribute(\"class\", \"cutImageStatus\");\r\n            this.captureWorkSpace.innerHTML = `\r\n                              <canvas class=\"screenCanvas\"></canvas>\r\n                              <div class=\"cut-tool\">\r\n                                <div class=\"tool-left\">\r\n                                  <button data-btnType=\"t-pen-btn\" type=\"button\" title=\"自定义-画笔\">笔</button>\r\n                                  <button data-btnType=\"t-rect-btn\" type=\"button\" title=\"矩形-画框\">框</button>\r\n                                  <button data-btnType=\"t-clear-btn\" type=\"button\" title=\"清空画布\">清</button>\r\n                                </div>\r\n                                <span class=\"tool-fg\"></span>\r\n                                <div class=\"tool-right\">\r\n                                  <button data-btnType=\"t-cancel-btn\" type=\"button\" title=\"取消\">取消</button>\r\n                                  <button data-btnType=\"t-save-btn\" type=\"button\" title=\"保存\">保存</button>\r\n                                </div>\r\n                              </div>`;\r\n            window.document.body.append(this.captureWorkSpace);\r\n            first = true;\r\n        }\r\n        this.canvas = this.captureWorkSpace.getElementsByTagName(\"canvas\")?.[0];\r\n        this.context = this.canvas?.getContext(\"2d\");\r\n        this.cutTool = this.captureWorkSpace.getElementsByClassName(\"cut-tool\")?.[0] as HTMLElement;\r\n\r\n        if(first){\r\n            //截图编辑工具区域按钮\r\n            this.cutTool.querySelector(\"button\")?.addEventListener(\"click\", (e) => {\r\n                let target = e.target as HTMLElement;\r\n                if (target.tagName !== \"BUTTON\") {\r\n                    target = target.closest(\"button\") as HTMLElement;\r\n                }\r\n                if (target) {\r\n                    const btnType = target.getAttribute(\"data-btnType\");\r\n                    switch (btnType) {\r\n                        //画笔\r\n                        case \"t-pen-btn\":\r\n                            this[selPen]();\r\n                            break;\r\n                        //画框\r\n                        case \"t-rect-btn\":\r\n                            this[selRect]();\r\n                            break;\r\n                        //清空\r\n                        case \"t-clear-btn\":\r\n                            this[clearCanvas]();\r\n                            break;\r\n                        //取消\r\n                        case \"t-cancel-btn\":\r\n                            this[closeCut]();\r\n                            break;\r\n                        //保存\r\n                        case \"t-save-btn\":\r\n                            this[saveCut]();\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.canvas.addEventListener(\"mousedown\", (e) => {\r\n                this[cutHandleCanvasMouseDown](e);\r\n            });\r\n            this.canvas.addEventListener(\"mousemove\", (e) => {\r\n                this[cutHandleCanvasMouseMove](e);\r\n            });\r\n            this.canvas.addEventListener(\"mouseup\", (e) => {\r\n                this[cutHandleCanvasMouseUp](e);\r\n            });\r\n            this.canvas.addEventListener(\"contextmenu\", (e) => {\r\n                this[rightCloseCut](e);\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n    static init(option?: Option) {\r\n        return new ZCapture(option);\r\n    }\r\n\r\n\r\n    [capture]() {\r\n        //全屏截图前事件\r\n        const before = this.option.before && this.option.before();\r\n        if (!before) {\r\n            return false;\r\n        }\r\n\r\n        if (this.shotPlugin === \"mediaDevices\") {\r\n            const video: any = window.document.createElement(\"video\");\r\n            const gdmOptions = {\r\n                video: true,\r\n                preferCurrentTab: true\r\n            }\r\n            const mediaDevices: any = navigator.mediaDevices;\r\n\r\n            mediaDevices.getDisplayMedia(gdmOptions).then((captureStream: MediaStream) => {\r\n                //截图开始事件\r\n                this.option.start && this.option.start();\r\n\r\n                video.srcObject = captureStream;\r\n                //500毫秒的延时是为了关闭录频提示框\r\n                setTimeout(() => {\r\n                    video.play().then(() => {\r\n                        if (this.canvas && this.context) {\r\n                            this.canvas.width = window.document.body.clientWidth;\r\n                            this.canvas.height = window.document.body.clientHeight;\r\n                            this.context.drawImage(video, 0, 0, this.canvas.width, this.canvas.height);\r\n                        }\r\n                        //进入截图界面，初始化状态\r\n                        this[intoShot]();\r\n                        captureStream.getTracks().forEach((track: any) => track.stop());\r\n                        video.remove();\r\n\r\n                        //截图完成\r\n                        this.option.end && this.option.end();\r\n                    });\r\n                }, 500);\r\n                //用户取消共享，会抛出异常\r\n            }).catch((err: any) => {\r\n                //异常\r\n                this.option.error && this.option.error(err);\r\n\r\n                if (err) {\r\n                    let e = err.toString() as string;\r\n                    if (~e.indexOf(\"NotAllowedError: Permission denied\")) {\r\n                        console.log(\"用户取消共享屏幕，截屏失败\");\r\n                    } else {\r\n                        console.error(\"Error: \" + err);\r\n                    }\r\n                }\r\n                //出现异常，关闭截图\r\n                this[closeCut]();\r\n            });\r\n        } else {\r\n            //截图开始事件\r\n            this.option.start && this.option.start();\r\n            html2canvas(window.document.getElementsByTagName(\"body\")[0], {\r\n                backgroundColor: 'white',\r\n                useCORS: true, //支持图片跨域\r\n                scale: 1       //设置放大倍数\r\n            }).then((canvas) => {\r\n                if (this.canvas && this.context) {\r\n                    this.canvas.width = window.document.body.clientWidth;\r\n                    this.canvas.height = window.document.body.clientHeight;\r\n                    this.context.drawImage(canvas, 0, 0, this.canvas.width, this.canvas.height);\r\n                }\r\n                //进入截图界面，初始化状态\r\n                this[intoShot]();\r\n                //截图完成\r\n                this.option.end && this.option.end();\r\n            });\r\n        }\r\n    };\r\n\r\n    //进入截图界面，初始化状态\r\n    [intoShot]() {\r\n        this.cutImageStatus = true;\r\n        //鼠标按下状态\r\n        this.cutDown = false;\r\n        //隐藏截图工具栏状态\r\n        this.cutTool?.remove();\r\n        //待编辑保存状态\r\n        this.cutWaitStatus = false;\r\n        //图片编辑缓存状态\r\n        this.canvasState = undefined;\r\n\r\n        setTimeout(() => {\r\n            if (this.canvas) {\r\n                this.cutScreenDataURL = this.canvas.toDataURL();\r\n                this[drawImageMask](0, 0, this.canvas.width, this.canvas.height, this.MASK_OPACITY);\r\n            }\r\n        }, 50);\r\n    }\r\n\r\n    MASK_OPACITY = 0.5;\r\n\r\n    [drawImageMask](x: number, y: number, width: number, height: number, opacity: number) {\r\n        if (this.context && this.cutImageStatus) {\r\n            this.context.fillStyle = `rgba(0,0,0,${opacity})`;\r\n            this.context.fillRect(x, y, width, height);\r\n        }\r\n\r\n    }\r\n\r\n    //绘制截图区域\r\n    [drawCutImageShot](width: number, height: number, startX: number, startY: number, rectWidth: number, rectHeight: number) {\r\n        //区域外部绘制\r\n        this[drawOutShadow](startX, startY, rectWidth, rectHeight);\r\n\r\n        //区域内部绘制\r\n        if (this.context) {\r\n            this.context.globalCompositeOperation = \"destination-over\";\r\n        }\r\n        this[drawScreenImg](width, height);\r\n    }\r\n\r\n    //绘制截图区域之外的阴影部分\r\n    [drawOutShadow](startX: number, startY: number, rectWidth: number, rectHeight: number) {\r\n        //新图形只绘制与原图像不重叠的部分，重叠部分透明\r\n        if (this.context) {\r\n            this.context.globalCompositeOperation = \"destination-out\";\r\n            this.context.fillStyle = \"rgb(0,0,0)\";\r\n            this.context.fillRect(startX, startY, rectWidth, rectHeight);\r\n        }\r\n    }\r\n\r\n    //绘制全屏截图\r\n    [drawScreenImg](width: number, height: number) {\r\n        const image = new Image();\r\n        image.src = this.cutScreenDataURL;\r\n        if (this.context) {\r\n            this.context.drawImage(image, 0, 0, width, height);\r\n        }\r\n        image.remove();\r\n    }\r\n\r\n    //鼠标按下开始坐标\r\n    private cutInitPos: Array<number> = new Array<number>(2);\r\n    //鼠标按下状态\r\n    private cutDown = false;\r\n    //待编辑保存状态\r\n    private cutWaitStatus = false;\r\n    //当前鼠标滑动状态 cut,line,rect\r\n    private cutMouseState = \"\";\r\n    //画布状态\r\n    private canvasState: undefined | ImageData;\r\n\r\n    //恢复画布状态\r\n    [restoreCanvasState]() {\r\n        if (this.canvasState && this.context) {\r\n            this.context.putImageData(this.canvasState, this.cutShotDataArray[0], this.cutShotDataArray[1]);\r\n        }\r\n    }\r\n\r\n    //鼠标按下开始\r\n    [cutHandleCanvasMouseDown](event: MouseEvent) {\r\n        //开始截图\r\n        if (!this.cutWaitStatus && this.cutImageStatus) {\r\n            this.cutInitPos = [event.offsetX, event.offsetY];\r\n            this.cutDown = true;\r\n            this.cutMouseState = \"cut\";\r\n        }\r\n\r\n        //编辑截图\r\n        if (this.canvas && this.context && this.cutWaitStatus && this[isWithinCutShotArea](event.offsetX, event.offsetY)) {\r\n            this.cutInitPos = [event.offsetX, event.offsetY];\r\n            this.cutDown = true;\r\n            //保存画布状态\r\n            let [sx, sy, sw, sh] = this.cutShotDataArray;\r\n            this.canvasState = this.context.getImageData(sx, sy, sw, sh);\r\n\r\n            //开始划线\r\n            if (this.cutEditStatus) {\r\n                // 开始绘制路径\r\n                this.cutMouseState = \"line\";\r\n                this.context.beginPath();\r\n                this.context.moveTo(event.clientX - this.canvas.offsetLeft, event.clientY - this.canvas.offsetTop);\r\n            }\r\n\r\n            //开始画框\r\n            if (this.cutRectStatus) {\r\n                this.cutMouseState = \"rect\";\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    //鼠标滑动进行\r\n    [cutHandleCanvasMouseMove](event: MouseEvent) {\r\n\r\n        if (this.cutDown && this.canvas && this.context) {\r\n            const endX = event.offsetX;\r\n            const endY = event.offsetY;\r\n            const [startX, startY] = this.cutInitPos;\r\n            const rectWidth = endX - startX;\r\n            const rectHeight = endY - startY;\r\n            const {width, height} = this.canvas;\r\n\r\n\r\n            switch (this.cutMouseState) {\r\n                //截图中\r\n                case \"cut\":\r\n                    //清空画布\r\n                    this.context.clearRect(0, 0, width, height);\r\n                    this.cutShotDataArray = [startX, startY, rectWidth, rectHeight];\r\n                    this[drawImageMask](0, 0, width, height, this.MASK_OPACITY);\r\n                    //绘制矩形截图\r\n                    this[drawCutImageShot](width, height, startX, startY, rectWidth, rectHeight);\r\n                    break;\r\n\r\n                //划线中\r\n                case \"line\":\r\n                    if (this[isWithinCutShotArea](endX, endY)) {\r\n                        this[drawFreeLine](event.clientX - this.canvas.offsetLeft, event.clientY - this.canvas.offsetTop);\r\n                    }\r\n\r\n                    break;\r\n\r\n                //画框中\r\n                case \"rect\":\r\n                    if (this[isWithinCutShotArea](endX, endY)) {\r\n                        this[drawFreeRect](startX, startY, rectWidth, rectHeight);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    [drawFreeLine](endX: number, endY: number) {\r\n        //恢复状态\r\n        this[restoreCanvasState]();\r\n        //新图形覆盖在原图像之上\r\n        if (this.context) {\r\n            this.context.globalCompositeOperation = \"source-over\";\r\n            this.context.strokeStyle = \"red\";\r\n            this.context.lineWidth = 2;\r\n            this.context.lineTo(endX, endY);\r\n            this.context.stroke();\r\n        }\r\n    }\r\n\r\n    [drawFreeRect](startX: number, startY: number, rectWidth: number, rectHeight: number) {\r\n        //恢复状态\r\n        this[restoreCanvasState]();\r\n        //新图形覆盖在原图像之上\r\n        if (this.context) {\r\n            this.context.globalCompositeOperation = \"source-over\";\r\n            this.context.beginPath();\r\n            this.context.strokeStyle = \"red\";\r\n            this.context.lineWidth = 2;\r\n            this.context.rect(startX, startY, rectWidth, rectHeight);\r\n            this.context.stroke();\r\n        }\r\n\r\n    }\r\n\r\n    //监测坐标是否在截图区域内\r\n    [isWithinCutShotArea](x: number, y: number) {\r\n        return x >= this.cutShotDataArray[0] &&\r\n            x <= this.cutShotDataArray[0] + this.cutShotDataArray[2] &&\r\n            y >= this.cutShotDataArray[1] &&\r\n            y <= this.cutShotDataArray[1] + this.cutShotDataArray[3];\r\n    }\r\n\r\n    //鼠标抬起完成\r\n    [cutHandleCanvasMouseUp](event: MouseEvent) {\r\n        if (this.cutDown && this.context) {\r\n            switch (this.cutMouseState) {\r\n                //截图结束\r\n                case \"cut\":\r\n                    this.cutDown = false;\r\n                    this.cutWaitStatus = true;\r\n                    if(this.captureWorkSpace && this.cutTool){\r\n                        this.cutTool.style.top = event.offsetY + \"px\";\r\n                        this.captureWorkSpace.appendChild(this.cutTool);\r\n                    }\r\n                    this.cutMouseState = \"\";\r\n                    break;\r\n                //结束划线\r\n                case \"line\":\r\n                    this.context.closePath();\r\n                    this.cutMouseState = \"\";\r\n                    this.cutDown = false;\r\n                    break;\r\n                //结束画框\r\n                case \"rect\":\r\n                    this.context.closePath();\r\n                    this.cutMouseState = \"\";\r\n                    this.cutDown = false;\r\n                    break;\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    //右键关闭\r\n    [rightCloseCut](event: Event) {\r\n        event.preventDefault();\r\n        this[closeCut]();\r\n    }\r\n\r\n    //关闭截图\r\n    [closeCut]() {\r\n        this.cutImageStatus = false;\r\n        this.cutWaitStatus = false;\r\n        this.cutTool?.remove();\r\n        //截图之后事件\r\n        this.option.after && this.option.after();\r\n    }\r\n\r\n    //启用画笔编辑\r\n    cutEditStatus = false;\r\n\r\n    [selPen]() {\r\n        if (this.cutWaitStatus) {\r\n            this.cutEditStatus = true;\r\n            this.cutRectStatus = false;\r\n        }\r\n\r\n    }\r\n\r\n    //启用画框编辑\r\n    cutRectStatus = false;\r\n\r\n    [selRect]() {\r\n        if (this.cutWaitStatus) {\r\n            this.cutRectStatus = true;\r\n            this.cutEditStatus = false;\r\n        }\r\n    }\r\n\r\n    [clearCanvas]() {\r\n        if (this.canvas && this.context) {\r\n            //清空选中区域画布\r\n            const [x, y, w, h] = this.cutShotDataArray;\r\n            this.context.clearRect(x, y, w, h);\r\n\r\n            const {width, height} = this.canvas;\r\n            this.canvasState = undefined;\r\n            //绘制矩形截图背景\r\n            this[drawCutImageShot](width, height, this.cutShotDataArray[0], this.cutShotDataArray[1], this.cutShotDataArray[2], this.cutShotDataArray[3]);\r\n        }\r\n\r\n    }\r\n\r\n    //保存截图\r\n    [saveCut]() {\r\n        if (this.canvas && this.context) {\r\n            const [x, y, w, h] = this.cutShotDataArray;\r\n            const data = this.context.getImageData(x, y, w, h);\r\n\r\n            const shotCanvas = window.document.createElement(\"canvas\");\r\n            const shotContext = shotCanvas.getContext(\"2d\");\r\n            if (shotContext != null) {\r\n                shotCanvas.width = data.width;\r\n                shotCanvas.height = data.height;\r\n                shotContext.putImageData(data, 0, 0);\r\n                //jpeg格式，数据更小\r\n                this.cutShotDataURL = shotCanvas.toDataURL('image/jpeg');\r\n                //确定保存截图\r\n                this.option.save && this.option.save(this.cutShotDataURL);\r\n            }\r\n            shotCanvas.remove();\r\n            this[closeCut]();\r\n        }\r\n    };\r\n}"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","_","label","sent","trys","ops","g","Object","create","Iterator","prototype","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","SuppressedError","selPen","selRect","clearCanvas","closeCut","saveCut","intoShot","drawImageMask","drawCutImageShot","drawOutShadow","restoreCanvasState","cutHandleCanvasMouseMove","drawFreeLine","cutHandleCanvasMouseUp","drawScreenImg","cutHandleCanvasMouseDown","isWithinCutShotArea","drawFreeRect","rightCloseCut","capture","defaultOption","engine","before","start","end","save","baseImg","navigator","clipboard","writeText","_a","after","error","console","ZCapture","option","_this","cutImageStatus","cutShotDataArray","Array","shotPlugin","MASK_OPACITY","cutInitPos","cutDown","cutWaitStatus","cutMouseState","cutEditStatus","cutRectStatus","assign","captureWorkSpace","window","document","getElementById","first","createElement","setAttribute","innerHTML","append","canvas","getElementsByTagName","context","_b","getContext","cutTool","_c","getElementsByClassName","_d","querySelector","addEventListener","target","tagName","closest","getAttribute","init","video_1","mediaDevices","getDisplayMedia","video","preferCurrentTab","captureStream","srcObject","setTimeout","play","width","clientWidth","height","clientHeight","drawImage","getTracks","forEach","track","stop","remove","catch","err","toString","indexOf","log","html2canvas","backgroundColor","useCORS","scale","canvasState","undefined","cutScreenDataURL","toDataURL","x","opacity","fillStyle","concat","fillRect","startX","startY","rectWidth","rectHeight","globalCompositeOperation","image","Image","src","putImageData","event","offsetX","offsetY","sx","sy","sw","sh","getImageData","beginPath","moveTo","clientX","offsetLeft","clientY","offsetTop","endX","endY","clearRect","strokeStyle","lineWidth","lineTo","stroke","rect","style","top","appendChild","closePath","preventDefault","w","h","data","shotCanvas","shotContext","cutShotDataURL"],"mappings":"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","x_google_ignoreList":[0]}